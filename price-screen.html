<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>شاشة الأسعار</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <!-- الترويسة -->
  <div class="header">
    <h2>شاشة الأسعار</h2>
    <div class="profile-icon">MS</div>
  </div>

  <!-- حالة السوق -->
  <div class="market-status">
    <div><span class="status-dot" id="status-dot"></span><span id="market-status-text">السوق مفتوح</span></div>
    <div class="market-time" id="market-time" style="margin-top:5px; font-size:0.9em;">سعر السوق اعتبارًا من ...</div>
  </div>

  <!-- شريط الأسهم -->
  <div class="tradingview-widget-container" style="margin-top:20px;">
    <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
    {
      "symbols":[{"proName":"ADX:ADIB","title":"ADIB"},{"proName":"ADX:ADCB","title":"ADCB"},{"proName":"ADX:ALDAR","title":"ALDAR"},{"proName":"ADX:FAB","title":"FAB"}],
      "colorTheme":"dark","isTransparent":false,"displayMode":"adaptive","locale":"ar"
    }
    </script>
  </div>

  <!-- القائمة الداخلية -->
  <div class="inner-nav">
    <button class="active">السوق الرئيسي</button>
    <button>المشتريات</button>
    <button>المبيعات</button>
    <button>الأرباح</button>
  </div>

  <!-- السوق الرئيسي -->
  <div class="market-content" id="market-main">
    <div class="filter-buttons">
      <button class="active">عرض الكل</button>
      <button>المفضلة</button>
      <button>خريطة تحركات الأسهم</button>
    </div>
    <div class="favorites">
      <div class="purchases-wrapper">
        <table class="favorites-table">
          <thead>
            <tr><th>مفضلة</th><th>الشعار</th><th>اسم السهم</th><th>رمز</th><th>آخر سعر</th><th>التغيير</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- المشتريات -->
  <div class="market-content" id="market-purchases" style="display:none;">
    <div class="favorites">
      <h3>المشتريات الأخيرة</h3>
      <div class="purchases-wrapper">
        <table class="favorites-table">
          <thead>
            <tr>
              <th>رمز</th><th>الكمية</th><th>سعر الشراء</th><th>العمولة</th><th>الضريبة</th>
              <th>مبلغ التداول</th><th>سعر الشراء الحقيقي</th>
              <th>سعر السهم حاليا</th><th>القيمة السوقية الان</th><th>قيمة التغير</th>
              <th>التاريخ</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- صفحات فارغة -->
  <div class="market-content empty" id="market-sales" style="display:none;"><div class="favorites"><p>لا توجد بيانات حالياً في المبيعات.</p></div></div>
  <div class="market-content empty" id="market-profits" style="display:none;"><div class="favorites"><p>لا توجد بيانات حالياً في الأرباح.</p></div></div>

  
  <!-- زر دائري عائم -->
  <div class="floating-button" onclick="openOverlay()">
    <i class="fas fa-plus"></i>
  </div>

  <!-- القائمة السفلية -->
  <div class="bottom-nav" id="bottom-nav">
  
    <a href="index.html"><i class="fas fa-home"></i><span>الرئيسية</span></a>
    <a href="#"><i class="fas fa-briefcase"></i><span>محفظتي</span></a>
    <a href="price.html"><i class="fas fa-chart-line"></i><span>شاشة الأسعار</span></a>
    <a href="#"><i class="fas fa-coins"></i><span>أرباح</span></a>
  </div>

  
  <!-- القائمة المنبثقة -->
  <div class="overlay-menu" id="overlayMenu" style="display:none;">
    <div class="overlay-header">
      <div class="overlay-title">خدماتي</div>
      <div class="overlay-icons">
        <i class="fas fa-comment-dots"></i>
        <i class="fas fa-cog"></i>
      </div>
    </div>

    <div class="overlay-section">
      <h3>راقب طلباتك</h3>
      <div class="overlay-grid vertical">
        <div class="overlay-item"><i class="fas fa-chart-pie"></i><span>تقاريري</span></div>
        <div class="overlay-item"><i class="fas fa-file-alt"></i><span>طلباتي</span></div>
        <div class="overlay-item"><i class="fas fa-users"></i><span>مستفيديني</span></div>
      </div>
    </div>

<div class="overlay-section">
  <h3>تقدم بطلب جديد</h3>
  <div class="overlay-grid vertical">
    <div class="overlay-item"><i class="fas fa-handshake"></i><span>اجتماعات</span></div>
    <div class="overlay-item"><i class="fas fa-home"></i><span>التحول العائلي</span></div>
    <div class="overlay-item"><i class="fas fa-envelope-open-text"></i><span>الرسائل المعتمدة</span></div>
    <div class="overlay-item"><i class="fas fa-file-invoice-dollar"></i><span>تحويل أوراق مالية مزدوجة</span></div>
    <div class="overlay-item"><i class="fas fa-money-bill-wave"></i><span>تحويل أوراق نقدية</span></div>
    <div class="overlay-item"><i class="fas fa-compress-arrows-alt"></i><span>دمج رقمي المستثمر</span></div>
  </div>
</div>
    
   <div class="overlay-close" onclick="closeOverlay()">
  <i class="fas fa-times"></i>
</div>
  </div>

  <!-- سكربتات -->
  <script>
    const buttons = document.querySelectorAll('.inner-nav button');
    const sections = {
      'السوق الرئيسي': document.getElementById('market-main'),
      'المشتريات': document.getElementById('market-purchases'),
      'المبيعات': document.getElementById('market-sales'),
      'الأرباح': document.getElementById('market-profits')
    };
    buttons.forEach(button => {
      button.addEventListener('click', () => {
        buttons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        Object.values(sections).forEach(sec => sec.style.display='none');
        const section = sections[button.textContent.trim()];
        if (section) section.style.display='block';
      });
    });

    function updateMarketStatus() {
      const now = new Date(), utc = now.getTime() + now.getTimezoneOffset() * 60000,
            uaeTime = new Date(utc + 4 * 3600000),
            h = uaeTime.getHours(), m = uaeTime.getMinutes().toString().padStart(2,'0'),
            d = uaeTime.getDate().toString().padStart(2,'0'), mo = (uaeTime.getMonth()+1).toString().padStart(2,'0'),
            y = uaeTime.getFullYear(), day = uaeTime.getDay(),
            open = day >= 1 && day <= 5 && h >= 10 && h < 14,
            s = document.getElementById("market-status-text"),
            dot = document.getElementById("status-dot"),
            t = document.getElementById("market-time");
      s.textContent = open ? "السوق مفتوح" : "السوق مغلق";
      dot.style.backgroundColor = open ? "#00e676" : "#ff1744";
      t.textContent = `سعر السوق اعتبارًا من ${h}:${m} UAE ${d}/${mo}/${y}`;
    }
    updateMarketStatus(); setInterval(updateMarketStatus, 1000);

    let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

    fetch('https://api.sheety.co/136f1878874f9351833ca417ad952e59/stock/adxPrice')
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector('#market-main tbody');
        tbody.innerHTML = '';
        data.adxPrice.forEach(row => {
          const isFav = favorites.includes(row.id.toString());
          tbody.innerHTML += `
            <tr>
              <td><i class="fas fa-star favorite-icon" data-id="${row.id}" style="cursor:pointer; color:${isFav ? '#2196f3' : '#ccc'};"></i></td>
              <td><img src="${row.logo}" alt="Logo" style="width:24px;height:24px;"></td>
              <td>${row.name}</td>
              <td>${row.id}</td>
              <td class="price-cell">${parseFloat(row.price).toFixed(3)}</td>
              <td>${row.prices}</td>
            </tr>`;
        });
      }).catch(err => console.error('فشل تحميل بيانات ADX_Price:', err));

    document.addEventListener('click', e => {
      if (e.target.classList.contains('favorite-icon')) {
        const icon = e.target, id = icon.dataset.id;
        if (favorites.includes(id)) {
          favorites = favorites.filter(f => f !== id);
          icon.style.color = '#ccc';
        } else {
          favorites.push(id);
          icon.style.color = '#2196f3';
        }
        localStorage.setItem('favorites', JSON.stringify(favorites));
      }
    });

    document.querySelector('.filter-buttons button:nth-child(2)').addEventListener('click', () => {
      const rows = document.querySelectorAll('#market-main tbody tr');
      rows.forEach(row => {
        const id = row.querySelector('.favorite-icon').dataset.id;
        row.style.display = favorites.includes(id) ? '' : 'none';
      });
      document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
      document.querySelector('.filter-buttons button:nth-child(2)').classList.add('active');
    });

    document.querySelector('.filter-buttons button:nth-child(1)').addEventListener('click', () => {
      document.querySelectorAll('#market-main tbody tr').forEach(row => row.style.display = '');
      document.querySelectorAll('.filter-buttons button').forEach(b => b.classList.remove('active'));
      document.querySelector('.filter-buttons button:nth-child(1)').classList.add('active');
    });

    fetch('https://api.sheety.co/136f1878874f9351833ca417ad952e59/stock/purchases')
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector('#market-purchases tbody');
        tbody.innerHTML = '';
        data.purchases.forEach(row => {
          const change = parseFloat(row.قيمةالتغير || 0);
          const arrow = change > 0 ? '↑' : (change < 0 ? '↓' : '');
          const color = change > 0 ? 'green' : (change < 0 ? 'red' : 'gray');
          tbody.innerHTML += `
            <tr>
              <td>${row.رمز}</td>
              <td>${row.الكمية}</td>
              <td>${parseFloat(row.سعرالشراء).toFixed(3)}</td>
              <td>${row.العمولة}</td>
              <td>${row.الضريبة}</td>
              <td>${parseFloat(row.مبلغالتداول).toFixed(2)}</td>
              <td>${parseFloat(row.سعرالشراءالحقيقي).toFixed(3)}</td>
              <td>${parseFloat(row.سعرالسهمحاليا).toFixed(3)}</td>
              <td>${parseFloat(row.القيمةالسوقيةالان).toFixed(2)}</td>
              <td style="color:${color}; font-weight:bold;">${arrow} ${Math.abs(change).toFixed(2)}</td>
              <td>${row.التاريخ}</td>
            </tr>`;
        });
      }).catch(err => console.error('فشل تحميل بيانات المشتريات:', err));

    // Scroll to top function
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  <!-- سكريب الزر الدائري -->
    
function openOverlay() {
  document.getElementById("overlayMenu").style.display = "flex";
  document.getElementById("bottom-nav").style.display = "none";

  // ✅ إخفاء زر +
  document.querySelector(".floating-button").style.display = "none";
}
    

  function closeOverlay() {
  document.getElementById("overlayMenu").style.display = "none";
  document.getElementById("bottom-nav").style.display = "flex";

  // ✅ إظهار زر +
  document.querySelector(".floating-button").style.display = "flex";
}

  </script>
  
</body>
</html>
